<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Intenção de Almoço - IFC SBS</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; }
      .container { max-width: 620px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
      .logo { width: 100%; max-width: 420px; display: block; margin: 0 auto 16px auto; }
      h1 { margin-top: 0; font-size: 1.5rem; }
      p { color: #444; }
      label { font-weight: 600; display: block; margin-top: 14px; }
      input, select { width: 100%; padding: 10px; border: 1px solid #cfd6dd; border-radius: 8px; margin-top: 6px; box-sizing: border-box; }
      .dias-group { margin-top: 10px; display: grid; grid-template-columns: repeat(5, minmax(80px, 1fr)); gap: 8px; }
      .dias-group label { font-weight: 400; margin: 0; display: flex; gap: 6px; align-items: center; }
      button { margin-top: 20px; width: 100%; padding: 12px; background: #198754; color: #fff; border: 0; border-radius: 8px; font-size: 1rem; cursor: pointer; }
      button:hover { background: #146c43; }
      .alert { padding: 10px 12px; border-radius: 8px; margin-top: 12px; }
      .ok { background: #d1f7de; color: #0b5a2a; }
      .err { background: #ffd9d9; color: #8f1a1a; }
      .small { font-size: .9rem; color: #666; margin-top: 14px; }
      .hint { margin-top: 8px; font-size: .9rem; color: #555; }
      .dia-semana { margin-top: 8px; font-size: .95rem; color: #198754; font-weight: 600; }
      @media (max-width: 600px) {
        .logo { max-width: 160px; }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <img class="logo" src="/static/logo_ifc_horizontal_SaoBentodosul.png" onerror="this.onerror=null;this.src='/static/logo-ifc.svg';" alt="Instituto Federal Catarinense" />
      <h1>Intenção de Almoço - IFC SBS</h1>
      <p>Preencha para informar em quais dias da semana você vai almoçar.</p>

      {% if sucesso %}
      <div class="alert ok">Resposta registrada com sucesso. Se precisar, você pode enviar novamente para atualizar sua escolha.</div>
      {% endif %}

      {% if erro %}
      <div class="alert err">{{ erro }}</div>
      {% endif %}

      <form action="/enviar" method="post">
        <label for="nome">Nome completo</label>
        <input id="nome" name="nome" type="text" required />

        <label for="turma">Turma</label>
        <select id="turma" name="turma" required>
          <option value="">Selecione...</option>
          {% for turma in turmas %}
          <option value="{{ turma }}">{{ turma }}</option>
          {% endfor %}
        </select>

        <label for="data_almoco">Data de referência da semana</label>
        <input id="data_almoco" name="data_almoco" type="date" value="{{ hoje }}" required />
        <div class="dia-semana" id="diaSemana"></div>

        <label>Marque os dias:</label>
        <div class="dias-group">
          <label><input type="checkbox" name="dias" value="seg" /> Seg</label>
          <label><input type="checkbox" name="dias" value="ter" /> Ter</label>
          <label><input type="checkbox" name="dias" value="qua" /> Qua</label>
          <label><input type="checkbox" name="dias" value="qui" /> Qui</label>
          <label><input type="checkbox" name="dias" value="sex" /> Sex</label>
        </div>

        <button type="submit">Enviar resposta</button>
      </form>

      <p class="small">Dica: salve este link no celular para responder rapidamente.</p>
    </main>

    <script>
      const campoData = document.getElementById("data_almoco");
      const diaSemana = document.getElementById("diaSemana");

      function atualizarDiaSemana() {
        const valor = campoData.value;
        if (!valor) {
          diaSemana.textContent = "";
          return;
        }

        const data = new Date(`${valor}T00:00:00`);
        const nomeDia = data.toLocaleDateString("pt-BR", { weekday: "long" });
        const nomeFormatado = nomeDia.charAt(0).toUpperCase() + nomeDia.slice(1);

        const segunda = new Date(data);
        const ajuste = (data.getDay() + 6) % 7;
        segunda.setDate(data.getDate() - ajuste);

        const sexta = new Date(segunda);
        sexta.setDate(segunda.getDate() + 4);

        const fmt = (d) => d.toLocaleDateString("pt-BR");
        diaSemana.textContent = `Dia da referência: ${nomeFormatado} | Semana: ${fmt(segunda)} a ${fmt(sexta)}`;
      }

      campoData.addEventListener("change", atualizarDiaSemana);
      atualizarDiaSemana();
    </script>
  </body>
</html>
